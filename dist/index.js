(()=>{const e="\nKeyboard:<br>\nn/s - start/stop;<br>\nj/k - position/color;\n";function t(e){return Math.floor(Math.random()*Math.floor(e))}var s=new class{constructor(){this.default_color="gray",this.color_list=["DarkOrchid","MintCream","DarkGreen","LawnGreen","Black","PowderBlue","RoyalBlue","Chocolate"]}clean_slate(){this.progress=!1,this.square=1,this.level=3,this.iteration=20,this.tick=0,this.history=[],this.penalty=1,this.square_guess=-1,this.color_guess=-1,this.score=0,this.total=0}score_update(){if(this.tick<=this.level)return;let e=this.tick-this.level-1,[t,s]=this.history[e];this.square_guess>-1&&(this.score+=t===this.square_guess?1:-this.penalty),this.color_guess>-1&&(this.score+=s===this.color_guess?1:-this.penalty),s===this.color&&this.total++,t===this.square&&this.total++}rig_game(){if(this.tick<this.level)return;let e=this.tick-this.level,[t,s]=this.history[e];Math.random()<.2&&(this.square=t),Math.random()<.2&&(this.color=s)}update(){this.square_guess=-1,this.color_guess=-1,this.square=t(9)+1,this.color=t(this.color_list.length),this.rig_game(),this.history.push([this.square,this.color])}},o=new class{constructor(){this.level=3,this.iteration=20,this.penalty=1}};function n(){i(),s.clean_slate(),o.level=Number(document.getElementById("level-slider").value),o.penalty=Number(document.getElementById("penalty").value),s.level=o.level,s.iteration=o.iteration,s.penalty=o.penalty,s.progress=!0,document.getElementsByTagName("button")[0].disabled=!0}function l(){window.clearTimeout(s.timer),i(),s.progress=!1}function i(){document.getElementById("Pos").classList.remove("active"),document.getElementById("Col").classList.remove("active"),document.getElementById("modeline").innerHTML=e,document.getElementsByTagName("button")[0].disabled=!1}function r(){if(s.progress)return;n();let e=()=>{s.tick<s.iteration?(s.tick>0&&s.score_update(),s.update(),s.tick++,function(){document.getElementById("Pos").classList.remove("active"),document.getElementById("Col").classList.remove("active");let e=`Round: ${s.tick} / ${s.iteration}`;document.getElementById("modeline").textContent=e;let t=document.getElementById("box"+s.square);t.style.background=s.color_list[s.color],window.setTimeout(()=>{t.style.background=s.default_color},1e3)}(),s.timer=window.setTimeout(e,2e3)):(s.score_update(),l(),function(){let e=Math.max(s.score,0),t=s.total,o=`Score: ${e} / ${t} (${Math.round(100*e/t)}%)`;document.getElementById("modeline").textContent=o}())};e()}window.addEventListener("keydown",e=>{if(!e.defaultPrevented)switch(e.key){case"n":case"Enter":r();break;case"s":l();break;case"j":s.square_guess=s.square,document.getElementById("Pos").classList.add("active");break;case"k":s.color_guess=s.color,document.getElementById("Col").classList.add("active");default:return}}),window.addEventListener("load",t=>{document.getElementsByTagName("button")[0].onclick=()=>{r()},document.getElementById("Pos").onclick=()=>{s.square_guess=s.square},document.getElementById("Col").onclick=()=>{s.color_guess=s.color},document.getElementById("toggle").onclick=()=>{document.getElementsByClassName("sidebar")[0].classList.toggle("open")},document.getElementById("modeline").innerHTML=e,document.getElementById("square").onclick=()=>{s.progress?l():r()};let o=document.getElementById("level-slider"),n=document.getElementById("level-show");n.innerHTML="Level: "+o.value,o.oninput=()=>{n.innerHTML="Level: "+o.value}})})();
